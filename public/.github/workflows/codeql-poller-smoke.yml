name: CodeQL Poller â€” Smoke Test

on:
  workflow_dispatch:
    inputs:
      hours:
        description: 'How many hours back to poll for recent alerts (smoke run size)'
        required: false
        default: '1'

permissions:
  actions: read
  code-scanning: read
  workflows: write

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Run poller in dry-run mode (smoke)
        uses: actions/github-script@v6
        with:
          script: |
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            const hours = parseInt(core.getInput('hours') || '1', 10);
            core.info(`Triggering poller for ${owner}/${repo} (hours=${hours}) in dry-run mode`);
            // Dispatch the poller with dry_run=true so it will only log actions
            await github.rest.actions.createWorkflowDispatch({ owner, repo, workflow_id: 'codeql-poller.yml', ref: 'main', inputs: { hours: String(hours), dry_run: 'true' } });
            core.info('Poller smoke: dispatched poller (dry-run=true). Inspect poller run logs to verify expected behavior.');